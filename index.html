// Update the integrateWithCalculator method in calculator-lead-integration.js

integrateWithCalculator(calculatorType, calculatorElement) {
    this.currentCalculatorType = calculatorType;
    this.trackInteraction('calculator_opened', { type: calculatorType });
    
    // Don't insert the lead form immediately - wait for calculation
    console.log(`ðŸ§® Calculator integrated: ${calculatorType}`);
}

// Update the onCalculationComplete method
onCalculationComplete(calculatorType, results) {
    this.currentCalculatorType = calculatorType;
    this.currentResults = results;
    this.calculationCompleted = true;
    this.userProfile.calculatorUsage++;
    
    this.trackInteraction('calculation_completed', {
        type: calculatorType,
        results: results
    });
    
    // Insert lead capture form after calculation
    this.insertLeadCaptureForm(calculatorType, results);
    
    // Setup exit intent after calculation
    setTimeout(() => {
        this.enableExitIntent();
    }, 5000);
    
    console.log(`ðŸ“Š Calculation completed: ${calculatorType}`, results);
}

// Add new method to insert lead capture form
insertLeadCaptureForm(calculatorType, results) {
    // Find the container for this calculator's lead capture
    const containerId = `${calculatorType}-lead-capture-container`;
    const container = document.getElementById(containerId);
    
    if (container && !container.hasChildNodes()) {
        const leadFormHTML = this.generateProgressiveLeadForm(calculatorType, results);
        container.innerHTML = leadFormHTML;
        
        // Re-run the input field fix for the new form
        this.fixInputFields();
    }
}

// Also update the generateProgressiveLeadForm to have better spacing
generateProgressiveLeadForm(calculatorType, results) {
    const urgencyMessage = this.getUrgencyMessage(calculatorType, results);
    const personalizedMessage = this.getPersonalizedMessage(calculatorType, results);
    const socialProof = this.getSocialProof(calculatorType);
    
    return `
    <div class="calculiq-lead-capture" id="leadCaptureContainer" style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin: 30px 0 0 0; /* Add top margin to separate from results */
        text-align: center;
        position: relative;
        overflow: hidden;
    ">
        <!-- Rest of your lead capture form HTML stays the same -->
        ${/* ... rest of the form ... */}
    </div>
    `;
}