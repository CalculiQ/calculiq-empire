<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CalculiQ - Smart Financial Calculators</title>
    <meta name="description" content="Free financial calculators for mortgages, investments, loans & insurance. Get instant personalized quotes from verified lenders.">
    
    <!-- Site Verification -->
    <meta name='impact-site-verification' value='c12c93df-3d1b-4b18-a3f8-2e3fc0c32a9f'>
    
    <!-- Lead capture integration -->
    <script src="calculator-lead-integration.js"></script>
    
    <style>
        :root {
            --primary: #1a1f3a;
            --accent: #646cff;
            --success: #10b981;
            --text: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: #fff;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 60px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(100, 108, 255, 0.05) 0%, transparent 70%);
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }
        
.hero h1 {
    font-size: 4rem;
    font-weight: 800;
    color: var(--primary);
    margin-bottom: 15px;
    position: relative;
    z-index: 1;
}
        
        .hero p {
            font-size: 1.25rem;
            color: #4b5563;
            max-width: 600px;
            margin: 0 auto 30px;
            position: relative;
            z-index: 1;
        }
        
        /* Trust Badges */
        .trust-badges {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .trust-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .trust-badge span {
            font-weight: 600;
            color: var(--primary);
        }
        
/* Calculator Grid */
.calculators {
    max-width: 1200px;
    margin: -40px auto 80px;
    padding: 0 20px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
    position: relative;
    z-index: 2;
}

@media (max-width: 768px) {
    .calculators {
        grid-template-columns: 1fr;
    }
}
        
        .calc-card {
            background: white;
            border-radius: 16px;
            padding: 35px 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .calc-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--accent), var(--success));
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        
.calc-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.calc-card {
    transition: all 0.3s ease;
}
        
        .calc-card:hover::before {
            opacity: 0.1;
        }
        
        .calc-icon {
            width: 60px;
            height: 60px;
            background: var(--light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 20px;
        }
        
        .calc-card h3 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .calc-card p {
            color: #6b7280;
            margin-bottom: 20px;
        }
        
        .calc-cta {
            color: var(--accent);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: gap 0.3s ease;
        }
        
        .calc-card:hover .calc-cta {
            gap: 10px;
        }
        
        /* Calculator Interface */
        .calculator-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .calculator-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calculator-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border: none;
            background: var(--light);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #6b7280;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #e5e7eb;
            color: var(--primary);
        }
        
        .calc-header {
            margin-bottom: 30px;
        }
        
        .calc-header h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .input-field {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(100, 108, 255, 0.1);
        }
        
        .input-addon {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-addon .input-field {
            flex: 1;
        }
        
        .addon-text {
            font-weight: 600;
            color: #6b7280;
        }
        
        .calc-button {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 25px;
        }
        
        .calc-button:hover {
            background: #5661ff;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(100, 108, 255, 0.3);
        }
        
        .results-section {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: var(--light);
            border-radius: 12px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .results-section.show {
            display: block;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: #6b7280;
        }
        
        .result-value {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .result-value.highlight {
            color: var(--success);
            font-size: 1.3rem;
        }
        
        /* CTA Section */
        .cta-section {
            background: var(--primary);
            color: white;
            padding: 80px 20px;
            text-align: center;
        }
        
        .cta-section h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .cta-section p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 40px;
        }
        
        .email-form {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            gap: 15px;
        }
        
        .email-input {
            flex: 1;
            padding: 16px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .email-submit {
            padding: 16px 30px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .email-submit:hover {
            background: #0f9d6e;
            transform: translateY(-2px);
        }
        
        /* Footer */
        footer {
            background: var(--light);
            padding: 40px 20px;
            text-align: center;
            color: #6b7280;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .footer-links a {
            color: #6b7280;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: var(--accent);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .trust-badges {
                gap: 15px;
            }
            
            .trust-badge {
                font-size: 0.8rem;
            }
            
            .calculators {
                grid-template-columns: 1fr;
                margin-top: -20px;
            }
            
            .calculator-content {
                padding: 30px 20px;
            }
            
            .email-form {
                flex-direction: column;
            }
        }
        
        /* FIX FOR INPUT FIELDS */
        input, select, textarea, button {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 9999 !important;
        }
        
        .calculator-modal * {
            pointer-events: auto !important;
        }
        
        .calculiq-lead-capture *,
        .profile-form *,
        .email-form * {
            pointer-events: auto !important;
        }
        
        .calculiq-lead-capture::before,
        .calculiq-lead-capture::after {
            pointer-events: none !important;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
<section class="hero">
    <h1>CalculiQ</h1>
    <p>Smart financial calculators that connect you with verified lenders in&nbsp;seconds</p>
    
    <div class="trust-badges">
        <div class="trust-badge">
            <span>✓</span> 100% Free
        </div>
        <div class="trust-badge">
            <span>✓</span> No Account Required
        </div>
        <div class="trust-badge">
            <span>✓</span> Instant Results
        </div>
        <div class="trust-badge">
            <span>✓</span> Compare Options
        </div>
    </div>
</section>

<!-- Calculator Cards -->
<section class="calculators">
    <div class="calc-card" onclick="openCalculator('mortgage')">
        <div class="calc-icon">🏠</div>
        <h3>Mortgage Calculator</h3>
        <p>Calculate payments & get pre-approved rates from top lenders</p>
        <div class="calc-cta">
            Calculate Now →
        </div>
    </div>

    <div class="calc-card" onclick="openCalculator('investment')">
        <div class="calc-icon">📈</div>
        <h3>Investment Calculator</h3>
        <p>Plan your wealth & connect with certified advisors</p>
        <div class="calc-cta">
            Start Planning →
        </div>
    </div>

    <div class="calc-card" onclick="openCalculator('loan')">
        <div class="calc-icon">💰</div>
        <h3>Loan Calculator</h3>
        <p>Compare rates & get instant loan offers</p>
        <div class="calc-cta">
            Check Rates →
        </div>
    </div>

    <div class="calc-card" onclick="openCalculator('insurance')">
        <div class="calc-icon">🛡️</div>
        <h3>Insurance Calculator</h3>
        <p>Find coverage & compare quotes instantly</p>
        <div class="calc-cta">
            Get Quotes →
        </div>
    </div>
</section>

    <!-- Calculator Modals -->
    <div class="calculator-modal" id="mortgage-modal">
        <div class="calculator-content">
            <button class="close-btn" onclick="closeCalculator('mortgage')">×</button>
            
            <div class="calc-header">
                <h2>Mortgage Calculator</h2>
                <p>See your monthly payment & get matched with lenders</p>
            </div>

            <div class="input-group">
                <label class="input-label">Home Price</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="home-price" value="400000">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Down Payment</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="down-payment" value="80000">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Interest Rate</label>
                <div class="input-addon">
                    <input type="number" class="input-field" id="interest-rate" value="6.5" step="0.1">
                    <span class="addon-text">%</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Loan Term</label>
                <select class="input-field" id="loan-term">
                    <option value="15">15 years</option>
                    <option value="30" selected>30 years</option>
                </select>
            </div>

            <button class="calc-button" onclick="calculateMortgage()">Calculate My Payment</button>

            <div class="results-section" id="mortgage-results">
                <div class="result-item">
                    <span class="result-label">Monthly Payment</span>
                    <span class="result-value highlight" id="monthly-payment">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Interest</span>
                    <span class="result-value" id="total-interest">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Amount</span>
                    <span class="result-value" id="total-paid">$0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Investment Calculator Modal -->
    <div class="calculator-modal" id="investment-modal">
        <div class="calculator-content">
            <button class="close-btn" onclick="closeCalculator('investment')">×</button>
            
            <div class="calc-header">
                <h2>Investment Calculator</h2>
                <p>See your growth potential & get expert advice</p>
            </div>

            <div class="input-group">
                <label class="input-label">Initial Investment</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="initial-investment" value="10000">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Monthly Contribution</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="monthly-contribution" value="500">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Expected Annual Return</label>
                <div class="input-addon">
                    <input type="number" class="input-field" id="annual-return" value="7" step="0.1">
                    <span class="addon-text">%</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Time Period</label>
                <div class="input-addon">
                    <input type="number" class="input-field" id="time-period" value="20">
                    <span class="addon-text">years</span>
                </div>
            </div>

            <button class="calc-button" onclick="calculateInvestment()">Calculate Growth</button>

            <div class="results-section" id="investment-results">
                <div class="result-item">
                    <span class="result-label">Future Value</span>
                    <span class="result-value highlight" id="final-amount">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Contributions</span>
                    <span class="result-value" id="total-contributions">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Earnings</span>
                    <span class="result-value" id="total-earnings">$0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loan Calculator Modal -->
    <div class="calculator-modal" id="loan-modal">
        <div class="calculator-content">
            <button class="close-btn" onclick="closeCalculator('loan')">×</button>
            
            <div class="calc-header">
                <h2>Loan Calculator</h2>
                <p>Calculate payments & compare lender offers</p>
            </div>

            <div class="input-group">
                <label class="input-label">Loan Amount</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="loan-amount" value="25000">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Interest Rate</label>
                <div class="input-addon">
                    <input type="number" class="input-field" id="loan-interest-rate" value="8.5" step="0.1">
                    <span class="addon-text">%</span>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Loan Term</label>
                <div class="input-addon">
                    <input type="number" class="input-field" id="loan-term-years" value="5">
                    <span class="addon-text">years</span>
                </div>
            </div>

            <button class="calc-button" onclick="calculateLoan()">Calculate Payment</button>

            <div class="results-section" id="loan-results">
                <div class="result-item">
                    <span class="result-label">Monthly Payment</span>
                    <span class="result-value highlight" id="loan-monthly-payment">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Interest</span>
                    <span class="result-value" id="loan-total-interest">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Total Repayment</span>
                    <span class="result-value" id="loan-total-repayment">$0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Insurance Calculator Modal -->
    <div class="calculator-modal" id="insurance-modal">
        <div class="calculator-content">
            <button class="close-btn" onclick="closeCalculator('insurance')">×</button>
            
            <div class="calc-header">
                <h2>Life Insurance Calculator</h2>
                <p>Find coverage amount & compare quotes</p>
            </div>

            <div class="input-group">
                <label class="input-label">Annual Income</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="annual-income" value="75000">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Current Age</label>
                <input type="number" class="input-field" id="current-age" value="35">
            </div>

            <div class="input-group">
                <label class="input-label">Number of Dependents</label>
                <input type="number" class="input-field" id="dependents" value="2">
            </div>

            <div class="input-group">
                <label class="input-label">Existing Debts</label>
                <div class="input-addon">
                    <span class="addon-text">$</span>
                    <input type="number" class="input-field" id="existing-debts" value="150000">
                </div>
            </div>

            <button class="calc-button" onclick="calculateInsurance()">Calculate Coverage</button>

            <div class="results-section" id="insurance-results">
                <div class="result-item">
                    <span class="result-label">Recommended Coverage</span>
                    <span class="result-value highlight" id="insurance-coverage">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Est. Monthly Premium</span>
                    <span class="result-value" id="insurance-premium">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Coverage Multiple</span>
                    <span class="result-value" id="coverage-multiple">0x</span>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA Section - UPDATED FOR NEWSLETTER -->
    <section class="cta-section">
        <h2>Stay Informed</h2>
        <p>Get weekly financial tips, rate updates, and money-saving strategies delivered to your inbox</p>
        
        <form class="email-form" onsubmit="handleNewsletterSubmit(event)">
            <input type="email" class="email-input" placeholder="Enter your email for financial tips" required>
            <button type="submit" class="email-submit">Subscribe Free</button>
        </form>
        
        <p style="font-size: 0.85rem; margin-top: 20px; opacity: 0.8;">
            Weekly financial insights • Rate alerts • No spam • Unsubscribe anytime
        </p>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-links">
            <a href="/privacy">Privacy Policy</a>
            <a href="/terms">Terms of Service</a>
            <a href="/contact">Contact</a>
            <a href="/do-not-sell">Do Not Sell My Info</a>
        </div>
        
        <div style="max-width: 800px; margin: 20px auto; padding: 0 20px; font-size: 0.85rem; line-height: 1.6; color: #6b7280;">
            <p><strong>Advertising Disclosure:</strong> CalculiQ provides free calculators and may receive compensation from lenders and financial service providers when users are matched or click through to partner sites. This compensation may impact how and where products appear.</p>
            
            <p style="margin-top: 10px;"><strong>Disclaimer:</strong> Calculator results are estimates only. Actual rates, terms, and approval depend on individual circumstances and lender requirements. CalculiQ is not a lender and does not make credit decisions.</p>
        </div>
        
        <p>&copy; 2024 CalculiQ. All rights reserved.</p>
    </footer>

    <script>
        // Helper function to format currency
        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Calculator Functions
        function openCalculator(type) {
            document.getElementById(`${type}-modal`).classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Track interaction
            if (window.calculiqIntegration) {
                window.calculiqIntegration.integrateWithCalculator(type, document.getElementById(`${type}-modal`));
            }
        }

        function closeCalculator(type) {
            document.getElementById(`${type}-modal`).classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close on background click
        document.querySelectorAll('.calculator-modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    const type = modal.id.replace('-modal', '');
                    closeCalculator(type);
                }
            });
        });

        function calculateMortgage() {
            const homePrice = parseFloat(document.getElementById('home-price').value) || 0;
            const downPayment = parseFloat(document.getElementById('down-payment').value) || 0;
            const interestRate = parseFloat(document.getElementById('interest-rate').value) || 0;
            const loanTerm = parseFloat(document.getElementById('loan-term').value) || 30;

            const loanAmount = homePrice - downPayment;
            const monthlyRate = (interestRate / 100) / 12;
            const numPayments = loanTerm * 12;

            const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                  (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            const totalPaid = monthlyPayment * numPayments;
            const totalInterest = totalPaid - loanAmount;

            // Display results with proper formatting
            document.getElementById('monthly-payment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('total-interest').textContent = formatCurrency(totalInterest);
            document.getElementById('total-paid').textContent = formatCurrency(totalPaid);
            document.getElementById('mortgage-results').classList.add('show');

            // Trigger lead capture with rounded values
            if (window.calculiqIntegration) {
                window.calculiqIntegration.onCalculationComplete('mortgage', {
                    monthlyPayment: Math.round(monthlyPayment * 100) / 100,
                    totalInterest: Math.round(totalInterest),
                    totalPaid: Math.round(totalPaid),
                    homePrice: Math.round(homePrice),
                    loanAmount: Math.round(loanAmount)
                });
            }
        }

        function calculateInvestment() {
            const initialInvestment = parseFloat(document.getElementById('initial-investment').value) || 0;
            const monthlyContribution = parseFloat(document.getElementById('monthly-contribution').value) || 0;
            const annualReturn = parseFloat(document.getElementById('annual-return').value) || 0;
            const timePeriod = parseFloat(document.getElementById('time-period').value) || 0;

            const monthlyRate = (annualReturn / 100) / 12;
            const numMonths = timePeriod * 12;
            
            const futureValueInitial = initialInvestment * Math.pow(1 + monthlyRate, numMonths);
            const futureValueMonthly = monthlyContribution * ((Math.pow(1 + monthlyRate, numMonths) - 1) / monthlyRate);
            
            const finalAmount = futureValueInitial + futureValueMonthly;
            const totalContributions = initialInvestment + (monthlyContribution * numMonths);
            const totalEarnings = finalAmount - totalContributions;

            // Display results with proper formatting
            document.getElementById('final-amount').textContent = formatCurrency(finalAmount);
            document.getElementById('total-contributions').textContent = formatCurrency(totalContributions);
            document.getElementById('total-earnings').textContent = formatCurrency(totalEarnings);
            document.getElementById('investment-results').classList.add('show');

            // Trigger lead capture with rounded values
            if (window.calculiqIntegration) {
                window.calculiqIntegration.onCalculationComplete('investment', {
                    finalAmount: Math.round(finalAmount),
                    totalContributions: Math.round(totalContributions),
                    totalEarnings: Math.round(totalEarnings)
                });
            }
        }

        function calculateLoan() {
            const loanAmount = parseFloat(document.getElementById('loan-amount').value) || 0;
            const interestRate = parseFloat(document.getElementById('loan-interest-rate').value) || 0;
            const loanTerm = parseFloat(document.getElementById('loan-term-years').value) || 0;

            const monthlyRate = (interestRate / 100) / 12;
            const numPayments = loanTerm * 12;

            const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                  (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            const totalRepayment = monthlyPayment * numPayments;
            const totalInterest = totalRepayment - loanAmount;

            // Display results with proper formatting
            document.getElementById('loan-monthly-payment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('loan-total-interest').textContent = formatCurrency(totalInterest);
            document.getElementById('loan-total-repayment').textContent = formatCurrency(totalRepayment);
            document.getElementById('loan-results').classList.add('show');

            // Trigger lead capture with rounded values
            if (window.calculiqIntegration) {
                window.calculiqIntegration.onCalculationComplete('loan', {
                    monthlyPayment: Math.round(monthlyPayment * 100) / 100,
                    totalInterest: Math.round(totalInterest),
                    totalRepayment: Math.round(totalRepayment),
                    loanAmount: Math.round(loanAmount)
                });
            }
        }

        function calculateInsurance() {
            const annualIncome = parseFloat(document.getElementById('annual-income').value) || 0;
            const currentAge = parseFloat(document.getElementById('current-age').value) || 0;
            const dependents = parseFloat(document.getElementById('dependents').value) || 0;
            const existingDebts = parseFloat(document.getElementById('existing-debts').value) || 0;

            const incomeMultiple = 10;
            const perDependent = 100000;
            const insuranceCoverage = (annualIncome * incomeMultiple) + existingDebts + (dependents * perDependent);
            
            const basePremiumRate = 0.0015;
            const ageMultiplier = currentAge > 40 ? 1.5 : 1.0;
            const monthlyPremium = (insuranceCoverage * basePremiumRate * ageMultiplier) / 12;
            
            const coverageMultiple = insuranceCoverage / annualIncome;

            // Display results with proper formatting
            document.getElementById('insurance-coverage').textContent = formatCurrency(insuranceCoverage);
            document.getElementById('insurance-premium').textContent = formatCurrency(monthlyPremium);
            document.getElementById('coverage-multiple').textContent = coverageMultiple.toFixed(1) + 'x';
            document.getElementById('insurance-results').classList.add('show');

            // Trigger lead capture with rounded values
            if (window.calculiqIntegration) {
                window.calculiqIntegration.onCalculationComplete('insurance', {
                    insuranceCoverage: Math.round(insuranceCoverage),
                    monthlyPremium: Math.round(monthlyPremium * 100) / 100,
                    coverageMultiple: Math.round(coverageMultiple * 10) / 10
                });
            }
        }

        // UPDATED NEWSLETTER FUNCTION
        async function handleNewsletterSubmit(event) {
            event.preventDefault();
            const email = event.target.querySelector('.email-input').value;
            
            try {
                const response = await fetch('/api/subscribe-newsletter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email,
                        source: 'footer_newsletter'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('✅ Subscribed! Welcome to CalculiQ financial insights.');
                } else {
                    alert('✅ Thanks for subscribing! Welcome to our newsletter.');
                }
                event.target.reset();
            } catch (error) {
                alert('✅ Thanks for subscribing! Welcome to our newsletter.');
                event.target.reset();
            }
        }

        // Fix for input fields not working
        document.addEventListener('DOMContentLoaded', function() {
            // Force fix for dynamically generated inputs
            setInterval(() => {
                // Find all inputs in the lead capture forms
                const inputs = document.querySelectorAll(
                    '#firstNameInput, #lastNameInput, #phoneInput, #creditScoreInput, ' +
                    '#leadEmailInput, #exitIntentEmail, .input-field, input[type="text"], ' +
                    'input[type="email"], input[type="tel"], select'
                );
                
                inputs.forEach(input => {
                    // Remove any blocking styles
                    if (input) {
                        input.style.position = 'relative';
                        input.style.zIndex = '9999';
                        input.style.pointerEvents = 'auto';
                        
                        // Force enable the input
                        input.disabled = false;
                        input.readOnly = false;
                        
                        // Add click handler if missing
                        if (!input.hasAttribute('data-click-fixed')) {
                            input.setAttribute('data-click-fixed', 'true');
                            input.addEventListener('click', function(e) {
                                e.stopPropagation();
                                this.focus();
                            });
                        }
                    }
                });
                
                // Also fix any parent containers
                const containers = document.querySelectorAll('.calculiq-lead-capture, .profile-form, .email-form');
                containers.forEach(container => {
                    if (container) {
                        container.style.position = 'relative';
                        container.style.zIndex = '1000';
                    }
                });
            }, 500); // Check every 500ms
        });
    </script>
</body>
</html>